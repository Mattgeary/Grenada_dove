setwd(paste(getwd(), "Figs_NEW_SURFACES", sep = "/"))
library(GISTools)
ppi <- 300

# Edit as appropriate...
forest.mod <- forest.mod.1
###

### Scalebar function
scalebar<-function(dim,coord=NA,padding=c(5,5),labels=paste(dim),...){
  #defaults to a lower left hand position
  padding<-padding/100
  parrange<-c(par()$usr[2]-par()$usr[1],par()$usr[4]-par()$usr[3])
  if(is.na(coord)) coord<-c(par()$usr[1]+(padding[1]*parrange[1]),par()$usr[3]+(padding[2]*parrange[2]))
  lines(matrix(c(coord[1],coord[2],coord[1]+dim,coord[2]),byrow=T,nrow=2),...)
  text(coord[1]+(0.5*dim),coord[2],labels=labels,adj=c(0.5,-0.25),...)
}

### Future climate stack 2050
climate.2050 <- stack(pred.sp, climate.fun(forest.mod, future.PER.50[[1]]), climate.fun(forest.mod, future.PER.50[[2]]))
names(climate.2050) <- c("Current", "rcp45 - 2050", "rcp85 - 2050")
save(climate.2050, file = "Climate_2050_NEW_SURFACES.RData")

png("Climate_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(6,6,0.5,5))
plot(climate.2050, axes = FALSE, box = FALSE)
dev.off()


### Future climate stack 2070
climate.2070 <- stack(pred.sp, climate.fun(forest.mod, future.PER.70[[1]]), climate.fun(forest.mod, future.PER.70[[2]]))
names(climate.2070) <- c("Current", "rcp45 - 2070", "rcp85 - 2070")
save(climate.2070, file = "Climate_2070_NEW_SURFACES.RData")

png("Climate_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(6,6,0.5,5))
plot(climate.2070, axes = FALSE, box = FALSE)
dev.off()

## Curent vs future 2050
png("rcp45_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mfrow = c(2,2))
plot(pred.sp, axes = FALSE, box = FALSE, main = "Current predicted suitability")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
plot(climate.fun(forest.mod, future.PER.50[[1]]), axes = FALSE, box = FALSE, main = "Predicted suitability under rcp45 - 2050")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
thresh.rcl <- matrix(c(-1, 0.343, 0, 0.343, 1.5, 1), nrow=2, ncol=3, byrow=TRUE)
plot(reclassify(pred.sp, thresh.rcl), axes = FALSE, box = FALSE, main = "Current predicted presence/absence")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
plot(reclassify(climate.fun(forest.mod, future.PER.50[[1]]), thresh.rcl), axes = FALSE, box = FALSE, main = "Predicted presence/absence under rcp45 - 2050")
plot(GRD, add= TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
par(mfrow = c(1,1))
dev.off()

## Curent vs future 2070
png("rcp45_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mfrow = c(2,2))
plot(pred.sp,axes = FALSE, box = FALSE, main = "Current predicted suitability")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
plot(climate.fun(forest.mod, future.PER.70[[1]]), axes = FALSE, box = FALSE, main = "Predicted suitability under rcp45 - 2070")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
thresh.rcl <- matrix(c(-1, 0.343, 0, 0.343, 1.5, 1), nrow=2, ncol=3, byrow=TRUE)
plot(reclassify(pred.sp, thresh.rcl), axes = FALSE, box = FALSE, main = "Current predicted presence/absence")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
plot(reclassify(climate.fun(forest.mod, future.PER.70[[1]]), thresh.rcl), axes = FALSE, box = FALSE, main = "Predicted presence/absence under rcp45 - 2070")
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
par(mfrow = c(1,1))
dev.off()

png("Current prediction.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(4,6,2,7))
plot(pred.sp, axes = FALSE, box = FALSE)
plot(GRD, add= TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.21, 0.005)
par(cex = 1, mar = c(5,4,4,2) + 0.1)
dev.off()

png("rcp45_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(4,6,2,7))
plot(climate.fun(forest.mod, future.PER.50[[1]]), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.21, 0.005)
dev.off()

png("rcp45_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(4,6,2,7))
plot(climate.fun(forest.mod, future.PER.70[[1]]), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.21, 0.005)
dev.off()

png("Current pa.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(4,6,2,7))
#tiff("Current_pa.tiff", res=600, compression = "lzw", height=5, width=5, units="in")
thresh.rcl <- matrix(c(-1, 0.343, 0, 0.343, 1.5, 1), nrow=2, ncol=3, byrow=TRUE)
plot(reclassify(pred.sp, thresh.rcl), axes = FALSE, box = FALSE)
plot(GRD, add= TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.21, 0.005)
dev.off()

png("PresAbs_rcp45_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(4,6,2,7))
thresh.rcl <- matrix(c(-1, 0.343, 0, 0.343, 1.5, 1), nrow=2, ncol=3, byrow=TRUE)
plot(reclassify(climate.fun(forest.mod, future.PER.50[[1]]), thresh.rcl), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.21, 0.005)
dev.off()

png("PresAbs_rcp45_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(4,6,2,7))
thresh.rcl <- matrix(c(-1, 0.343, 0, 0.343, 1.5, 1), nrow=2, ncol=3, byrow=TRUE)
plot(reclassify(climate.fun(forest.mod, future.PER.70[[1]]), thresh.rcl), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.21, 0.005)
dev.off()

png("Hurricane_examples.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(6,6,0.5,5))
par(mfrow = c(2,2))
plot(pred.sp - hurricane(alt), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
plot(pred.sp - hurricane(alt), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
plot(pred.sp - hurricane(alt), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
plot(pred.sp - hurricane(alt), axes = FALSE, box = FALSE)
plot(GRD, add = TRUE)
dev.off()

box.labels <- c("Hurricanes", "Sea level\n& Land use", "Hurricanes\n& Land use", "Sea level,\nLand use\n& Hurricanes", "Sea level\n& Hurricanes", "All rcp45", "All rcp85")

png("Scenarios_results_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mar = c(10, 5, 2,2), cex = 2)
boxplot(f.50$whole[,1:7], ylab = "Percentage area predicted present", las = 2, names = box.labels, main = "2050")
abline(f.50[[1]][3], 0, col = "red")
par(mar = c(5,4,4,2) + 0.1)
dev.off()


png("Scenarios_results_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mar = c(10, 5, 2,2) , cex = 2)
boxplot(f.70$whole[,1:7], ylab = "Percentage area predicted present", las = 2, names = box.labels, main = "2070")
abline(f.50[[1]][3], 0, col = "red")
par(mar = c(5,4,4,2) + 0.1)
dev.off()

png("Scenarios_climate_results_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mar = c(6, 5, 2,2) , cex = 2)
boxplot(f.50$whole[,6:7], ylab = "Percentage area predicted present", las = 2, names = box.labels[6:7], main = "2050", ylim = c(0.3, 0.55))
abline(f.50[[1]][3], 0, col = "red")
par(mar = c(5,4,4,2) + 0.1)
dev.off()

png("Scenarios_climate_results_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mar = c(6, 5, 2,2), cex = 2)
boxplot(f.70$whole[,6:7], ylab = "Percentage area predicted present", las = 2, names = box.labels[6:7], main = "2070")
abline(f.50[[1]][3], 0, col = "red")
par(mar = c(5,4,4,2) + 0.1)
dev.off()

png("Hurricane_climate_results_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mar = c(5, 5, 2,2), cex = 2)
boxplot(f.50$whole[,8:9], ylab = "Percentage area predicted present", las = 2, names = c("rcp45", "rcp80"), main = "2050", ylim = c(0.5, 0.9))
abline(f.50[[1]][3], 0, col = "red")
par(mar = c(5,4,4,2) + 0.1)
dev.off()

png("Hurricane_climate_results_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(mar = c(5, 5, 2,2), cex = 2)
boxplot(f.70$whole[,8:9], ylab = "Percentage area predicted present", las = 2, names = c("rcp45", "rcp80"), main = "2070", ylim = c(0.5, 1))
abline(f.50[[1]][3], 0, col = "red")
par(mar = c(5,4,4,2) + 0.1)
dev.off()

lum <- reclassify(land.use.mask, cbind(0, NA))

png("Land_use_mask.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(6,6,0.5,5))
plot(pred.sp, axes = FALSE, box = FALSE)
plot(lum, alpha = 0.7, add = TRUE, legend = FALSE, col= rev(gray.colors(n =2)))
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
dev.off()

png("Land_use_mask_2050.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(6,6,0.5,5))
plot(climate.fun(forest.mod, future.PER.50[[1]]), axes = FALSE, box = FALSE)
plot(lum, alpha = 0.7,  add = TRUE, legend = FALSE, col= rev(gray.colors(n =2)))
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
dev.off()

png("Land_use_mask_2070.png", width = 12*ppi, height = 12*ppi, res = ppi)
par(cex = 2, mar = c(6,6,0.5,5))
plot(climate.fun(forest.mod, future.PER.70[[1]]), axes = FALSE, box = FALSE)
plot(lum, alpha = 0.7, add = TRUE, legend = FALSE, col= rev(gray.colors(n =2)))
plot(GRD, add = TRUE)
points(forest.env[,2], forest.env[,1], pch = 16,  col = (forest.env$pres+2)*2, cex =2)
points(test.env[,2], test.env[,1], pch = 16,  col = (test.env$pres+2)*2, cex =2)
scalebar(0.045, padding = c(2, 80), labels = "5 km", cex = 2)
north.arrow(-61.777, 12.205, 0.005)
dev.off()